# 交易信息撮合平台 - 产品需求文档 (PRD)

**文档版本**: V1.0
**创建日期**: 2025-01-27
**产品定位**: 积分驱动的C2C交易信息撮合平台

---

## 📋 目录

1. [产品概述](#产品概述)
2. [用户角色与权限](#用户角色与权限)
3. [核心业务流程](#核心业务流程)
4. [功能模块详细需求](#功能模块详细需求)
5. [界面与交互设计](#界面与交互设计)
6. [后台管理系统](#后台管理系统)
7. [技术需求规范](#技术需求规范)
8. [运营与风控](#运营与风控)
9. [数据指标与监控](#数据指标与监控)
10. [项目里程碑](#项目里程碑)

---

## 🎯 产品概述

### 产品定位
一个基于积分制度的C2C交易信息撮合平台，专注于"做多"与"做空"交易信息的快速发布与精准匹配，通过智能算法和信用体系提升交易效率。

### 核心价值主张
- **高效撮合**: 通过积分机制确保信息质量，提升匹配效率
- **信用体系**: 基于成交率的信任机制，降低交易风险
- **即时触达**: 移动端优先设计，随时随地发布和查看信息
- **平台中立**: 仅提供信息撮合服务，不承担交易担保责任

### 商业模式
- **发布收费**: 用户支付积分发布信息，积分数决定联系方式可被查看次数
- **查看收费**: 用户支付积分查看联系方式，实现信息价值变现
- **积分流通**: 平台通过积分充值实现盈利，积分作为平台内流通货币

---

## 👥 用户角色与权限

### 普通用户
| 权限类型 | 描述 |
|---------|------|
| 基础权限 | 注册登录、发布信息、查看信息、标记成交 |
| 积分权限 | 积分查看、充值、消费、获得奖励 |
| 社交权限 | 邀请好友、查看他人成交率 |
| 个人管理 | 管理发布信息、查看历史记录 |

### 管理员
| 权限类型 | 描述 |
|---------|------|
| 用户管理 | 查看、禁用、积分操作、行为分析 |
| 内容管理 | 审核、删除、批量发布、关键词监控 |
| 财务管理 | 充值确认、流水查看、统计分析 |
| 系统管理 | 参数配置、公告发布、数据监控 |

---

## 🔄 核心业务流程

### 用户注册流程
```mermaid
graph TD
    A[用户输入手机号] --> B[发送验证码]
    B --> C[输入验证码]
    C --> D[填写微信号]
    D --> E[设置邀请码可选]
    E --> F[注册成功]
    F --> G[获得100积分奖励]
    G --> H[进入首页]
```

### 交易信息发布流程
```mermaid
graph TD
    A[点击发布] --> B[选择交易类型]
    B --> C[填写必填信息]
    C --> D[确认发布]
    D --> E[扣除10积分]
    E --> F[获得10次查看机会]
    F --> G[信息上线展示]
    G --> H[72小时后自动下架]
```

### 信息查看与成交流程
```mermaid
graph TD
    A[浏览信息列表] --> B[查看详情]
    B --> C[点击查看联系方式]
    C --> D[支付1积分]
    D --> E[自动复制微信号]
    E --> F[24小时后弹窗询问]
    F --> G{是否成交?}
    G -->|是| H[更新成交率]
    G -->|否| I[无变化]
```

### 积分流转流程
```mermaid
graph LR
    A[用户充值] --> B[平台积分池]
    C[发布信息] --> D[扣除发布积分]
    E[查看信息] --> F[扣除查看积分]
    G[自动下架] --> H[退还剩余积分]
    I[邀请奖励] --> J[发放奖励积分]
    D --> B
    F --> B
    H --> B
    J --> B
```

---

## 📱 功能模块详细需求

### 1. 账号与验证系统

#### 1.1 用户注册
**功能描述**: 新用户通过手机号和微信号完成注册

**输入字段**:
- 手机号码 (必填，11位数字)
- 短信验证码 (必填，6位数字)
- 微信号 (必填，注册后不可修改)
- 邀请码 (选填)

**业务规则**:
- 手机号唯一性校验
- 微信号格式校验 (6-20位字母、数字、下划线、减号)
- 验证码5分钟有效期，3次错误锁定1小时
- 注册成功自动到账100积分并Toast提示

**交互细节**:
- 实时格式校验，错误时红色边框提示
- 倒计时显示验证码重发剩余时间
- 注册成功跳转到首页，显示新手引导

#### 1.2 用户登录
**功能描述**: 已注册用户通过手机验证码登录

**输入字段**:
- 手机号码 (必填)
- 短信验证码 (必填)

**业务规则**:
- 手机号必须在系统中存在
- 验证码校验正确后登录成功
- 登录状态保持30天

**交互细节**:
- 输入手机号后自动显示历史登录记录
- 登录成功返回上一页面或首页

### 2. 邀请奖励机制

#### 2.1 邀请码系统
**功能描述**: 用户通过邀请码邀请好友获得积分奖励

**邀请流程**:
1. 用户在个人中心获取专属邀请码
2. 分享邀请码给好友
3. 好友注册时填写邀请码
4. 好友完成首次发布后发放奖励

**奖励规则**:
- 邀请人: +10积分
- 被邀请人: +30积分
- 触发条件: 被邀请人完成首次交易信息发布

**交互细节**:
- 邀请码一键复制功能
- 实时显示邀请状态 (待发布/已完成)
- 奖励到账Toast通知

### 3. 交易信息系统

#### 3.1 信息发布
**功能描述**: 用户发布交易信息到平台

**发布表单字段**:
```
标题 (必填, ≤30字)
关键词 (必填, 3-5个, 英文逗号分隔)
价格 (必填, 数字, ≥0)
交易类型 (必填, 单选: 求购/出售/做多/做空)
交割时间 (条件必填, 仅做多/做空, 日期选择器≥今天)
补充信息 (条件必填, 仅做多/做空, ≤20字)
联系方式 (必填, 只读, 显示注册微信号)
```

**发布规则**:
- 所有字段必填校验
- 发布即扣除10积分
- 获得10次联系方式查看机会
- 信息有效期72小时

**交互细节**:
- 实时字数统计显示
- 交易类型选择动态显示相关字段
- 发布成功后跳转到信息详情页

#### 3.2 信息展示
**功能描述**: 以列表形式展示平台所有交易信息

**列表卡片信息**:
- 标题 (截断显示20字)
- 价格 (数字格式化显示)
- 交易类型徽章 (不同颜色区分)
- 发布者成交率 (星级显示)
- 剩余查看次数 (进度条展示)
- 发布时间 (相对时间显示)

**交互功能**:
- 下拉加载更多 (每页20条)
- 点击查看详情
- 长按显示快速操作菜单

#### 3.3 信息搜索
**功能描述**: 用户通过关键词搜索相关交易信息

**搜索功能**:
- 模糊搜索 (标题+关键词字段)
- 即时搜索建议
- 搜索历史记录 (最多5条)
- 热门关键词推荐 (后台配置10条)

**筛选功能**:
- 按交易类型筛选
- 按价格区间筛选
- 按发布时间筛选

**排序规则**:
1. 成交率降序 (权重70%)
2. 发布时间倒序 (权重30%)
3. 剩余查看次数 (次要排序)

#### 3.4 信息详情
**功能描述**: 展示交易信息的完整内容

**详情页内容**:
- 完整标题和描述
- 所有发布信息字段
- 发布者信息 (头像、成交率、发布数)
- 查看联系方式按钮
- 分享功能

**联系方式查看**:
- 支付1积分查看
- 自动复制微信号到剪贴板
- Toast提示复制成功
- 记录查看行为

#### 3.5 AI批量发布
**功能描述**: 用户在一次输入中描述多个交易信息，系统调用大模型拆分内容、生成多条草稿，统一沿用同一个交易类型与联系方式，用户审核后可一键发布。

**表单结构**:
- 交易类型：必填，枚举“做多/做空/求购/转让”等，应用于所有拆分后的信息。
- 联系方式：必填，支持微信/手机号，仅填写一次，解析结果自动继承。
- 原始描述：多行文本，支持粘贴类似“成都周深 399 的 900…”的自然语言段落。
- 可选字段：标签、备注、期望发布时间等，默认同步到所有生成项。

**解析流程**:
1. 用户填写统一字段 → 点击“AI解析”。
2. 前端生成批次 ID 并调用 `/api/listings/batch/parse`，传入原始文本与统一字段。
3. 后端调用 DeepSeek Chat Completions，将文本拆分为结构化 JSON（例：`[{"title":"成都周深399","price":900}, …]`）。
4. 系统生成草稿列表，默认补全交易类型、联系方式，可逐条编辑/删除。
5. 用户确认后调用 `/api/listings/batch/submit`，系统按单条发布逻辑串行创建，并记录批次日志。

**大模型集成**:
- 服务：DeepSeek，走标准 OpenAI 接口协议，Endpoint `https://api.deepseek.com/v1/chat/completions`。
- 鉴权：`Authorization: Bearer sk-4dac2f720dfc43a18dc3f46053a68f16`，必须配置在安全的密钥管理（ENV/Secret Manager），勿写入前端。
- Prompt：指明仅输出 JSON 数组字段（title、price、currency、remark），忽略无法解析的行并给出 reason。
- 审计：记录原始文本、模型返回与人工修改痕迹，便于回溯。

**错误与降级**:
- JSON 解析失败或模型超时 → 显示错误提示，并提供“手动按行拆分”备选方案。
- 批量发布时若部分条目失败，应返回成功/失败明细，支持对失败条目重新提交。
- 每次批量操作均计入积分扣减预估，确认弹窗中提示“共发布N条，预计扣除10×N积分”。

### 4. 积分系统

#### 4.1 积分获取
**获取途径**:

| 途径 | 积分数量 | 条件说明 |
|------|---------|---------|
| 注册奖励 | +100 | 首次注册成功 |
| 邀请奖励 | +10 | 被邀请人完成首次发布 |
| 被邀请奖励 | +30 | 完成首次发布 |
| 下架退还 | +剩余次数 | 自动/手动下架时 |

#### 4.2 积分消费
**消费场景**:

| 场景 | 积分数量 | 说明 |
|------|---------|------|
| 发布信息 | -10 | 获得10次联系方式查看额度 |
| 查看联系方式 | -1 | 单次查看费用 |

**说明**:
- 批量发布按照解析后的最终条目逐条扣除发布积分（示例：拆成4条需扣40分）。
- 所有扣减同步写入积分流水，供风控与财务稽核。

#### 4.3 积分充值
**充值方式**:
1. 支持自定义金额（1元=10积分）与固定套餐两种方式。
2. 页面同时展示微信、支付宝收款二维码，用户仅需选择其一扫码。
3. 必须上传≤2MB的付款成功截图（JPG/PNG/HEIC），便于人工核对。
4. 收款二维码由后台“财务管理→二维码管理”上传，统一托管在 Supabase Storage bucket `recharge-assets`，前端通过 CDN 缓存5分钟、支持热更新（更新后立即刷新缓存版本号）。

**充值套餐**:

| 档位 | 支付金额 | 基础积分 | 赠送积分 | 合计积分 |
|------|---------|----------|----------|----------|
| 档位A | 100元 | 1000 | +5 | 1005 |
| 档位B | 200元 | 2000 | +20 | 2020 |
| 档位C | 300元 | 3000 | +50 | 3050 |
| 档位D | 500元 | 5000 | +200 | 5200 |

**提交流程**:
1. 选择自定义金额或固定套餐，填写备注信息。
2. 扫码支付并上传付款截图，勾选同意充值须知。
3. 提交后生成充值记录和财务工单，状态置为“待审核”。

**审核与通知**:

**短信配置**:
- 平台：Spug SMS，按照文档 https://push.spug.cc/guide/sms-code 配置。
- 调用地址：`https://push.spug.cc/send/Xyd9M8AlV5rKbDBk`，`user_id=5a73b0f94f134f03a9175c186a0f5fec`，`app_key=ak_oYWyP1Dwvzk9qMjwxerBRgQp6E4NeAnb`。
- 管理员手机号列表保存在后台“系统设置→通知配置”，支持多值，默认选择财务值班人员。
- 每条短信包含：用户昵称、充值金额、套餐档位、工单ID与凭证链接（截图存储 URL）。

**短信请求示例**:
```json
{
  "user_id": "5a73b0f94f134f03a9175c186a0f5fec",
  "app_key": "ak_oYWyP1Dwvzk9qMjwxerBRgQp6E4NeAnb",
  "mobile": ["13800001111", "13900002222"],
  "template": "finance_recharge_alert",
  "params": {
    "user": "成都票务-小李",
    "amount": "¥300",
    "plan": "档位C",
    "order_id": "RC20250201001",
    "proof_url": "https://cdn.example.com/finance-proof/RC20250201001.png"
  }
}
```
- 若短信发送失败，系统需通过管理员站内信+邮箱兜底提示，确保人工及时处理。

- 系统同时给管理员发送短信提醒：调用 Spug SMS（文档：https://push.spug.cc/guide/sms-code），POST `https://push.spug.cc/send/Xyd9M8AlV5rKbDBk`，携带 `user_id=5a73b0f94f134f03a9175c186a0f5fec`、`app_key=ak_oYWyP1Dwvzk9qMjwxerBRgQp6E4NeAnb` 以及订单摘要。
- 管理员在后台财务管理→充值工单中完成人工核对（查看备注、截图、支付渠道）。
- 确认到账后，填写到账金额与备注，系统自动增加对应积分并通知用户；若驳回需填写原因。

#### 4.4 积分退还规则
**触发场景**: 信息到期自动下架（72小时）或用户手动下架。

**计算方式**:
- 退还积分 = 剩余可被查看次数 × 1积分。
- 完整示例：
  - 未被查看：退还10积分；
  - 被查看5次：退还5积分；
  - 被查看10次：不退还积分。

**实现要求**:
- 退还结果和原始扣减同样写入积分流水，确保幂等可追溯。
- 退还与下架操作绑定同一事务，避免重复退还或漏退。
- 退还记录在“积分明细”和“发布记录”中可见，便于用户核对。

#### 4.5 凭证及数据存储策略
**存储位置**:
- 充值截图、二维码、AI 批量解析原文等媒资统一存入 Supabase Storage：
  - Bucket `recharge-assets`: 存放二维码及所有财务相关图片，开启 CDN + 版本号缓存策略。
  - Bucket `finance-proof`: 存放用户上传的付款截图与解析出的 JSON 文件，默认私有访问，通过签名 URL 提供审核端查看。
- 元数据（URL、MD5、上传人、版本号、订单ID）写入 `finance_recharge_orders` 表，遵循永久保存要求。

**保留策略**:
- 充值订单数据永久保存，不允许删除，仅能归档；必要时通过“脱敏导出”满足合规审计。
- 媒资文件至少保存 5 年，定期校验哈希确保未被篡改，如需迁移必须保证新旧 URL 兼容或自动回源。
- 所有 Supabase Storage 操作使用服务密钥执行，前端仅通过临时签名 URL 访问，避免泄露。

**安全要求**:
- 上传前执行病毒扫描与大小校验，失败即拒绝。
- 生成的签名链接有效期≤24小时，避免长期外泄。
- 对接 EdgeOne/Supabase 时，需在基础设施层面启用 HTTPS 与访问日志，供风控溯源。

### 5. 成交率系统

#### 5.1 成交率计算
**计算公式**:
```
成交率 = (被标记成交的总信息数 ÷ 发布的总信息数) × 100%
```

**更新规则**:
- 查看联系方式的用户24小时后收到成交确认弹窗
- 用户确认成交后立即更新发布者成交率
- 保留1位小数显示

#### 5.2 成交确认流程
**确认时机**: 查看联系方式24小时后
**确认方式**: 弹窗询问 "是否成交?"
- 选择"是": 该条信息成交计数+1
- 选择"否"或关闭: 无变化

### 6. 信息生命周期管理

#### 6.1 自动下架
**下架条件**: 发布时间满72小时±5分钟
**下架动作**:
- 信息状态变更为"已下架"
- 按剩余查看次数退还积分
- 发送下架通知

#### 6.2 手动下架
**用户操作**: 在"我的发布"中点击"下架"
**处理规则**: 同自动下架

#### 6.3 重新上架
**用户操作**: 对已下架信息点击"重新上架"
**处理流程**:
- 再次扣除10积分
- 重置查看次数为10次
- 重置到期时间为当前时间+72小时
- 信息状态恢复为"上架中"

### 7. 用户中心

#### 7.1 仪表盘
**顶部数据卡片**:
- 可用积分余额
- 个人成交率
- 总发布数量

#### 7.2 我的发布
**列表信息**:
- 信息标题和摘要
- 状态徽章 (上架中/已下架)
- 剩余查看次数进度条
- 操作按钮 (下架/重新上架)

**功能操作**:
- 下架操作 (上架中状态)
- 重新上架 (已下架状态)
- 查看详情
- 编辑信息 (下架状态)

#### 7.3 我的足迹
**功能描述**: 展示用户付费查看过的所有交易信息

**列表信息**:
- 信息标题和价格
- 查看时间
- 成交标记状态

**功能操作**:
- 免积分再次查看联系方式
- 标记成交 (24小时后)
- 分享信息

#### 7.4 积分明细
**流水记录**:
- 收入记录 (绿色显示)
- 支出记录 (红色显示)
- 时间戳
- 事件说明
- 积分变化数量

### 8. 系统公告

#### 8.1 公告发布 (后台)
**发布权限**: 管理员
**发布内容**:
- 公告标题
- 公告内容 (支持富文本)
- 显示优先级

#### 8.2 公告展示 (前端)
**展示位置**: 用户首页顶部固定横幅
**展示规则**:
- 最新公告优先显示
- 用户可手动关闭
- 关闭后24小时内不再显示

---

## 🎨 界面与交互设计

### 设计原则
- **移动端优先**: 所有界面基于手机屏幕优化
- **信息密度高**: 便于快速浏览和操作
- **操作反馈即时**: 200ms内给出视觉反馈
- **导航简洁清晰**: 最多4级页面深度

### 核心页面规范

#### 首页布局
```
┌─────────────────────────┐
│ 🔍 搜索交易信息...      │
├─────────────────────────┤
│ [全部] [求购] [出售] [做多] [做空] │
├─────────────────────────┤
│ ┌─────────────────────┐ │
│ │ [急] iPhone15出售   │ │
│ │ ¥5800 出售 ★★★★☆  │ │
│ │ 查看: 7/10 成交率:85%│ │
│ │ 2小时前            │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ 求购华为Mate60      │ │
│ │ ¥4500 求购 ★★★☆☆  │ │
│ │ 查看: 3/10 成交率:60%│ │
│ │ 5小时前            │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

#### 个人中心布局
```
┌─────────────────────────┐
│ 积分余额: 150          │
│ 成交率: 75%            │
│ 发布数: 12             │
├─────────────────────────┤
│ [我的发布] [我的足迹]    │
│ [积分明细] [充值中心]    │
├─────────────────────────┤
│ 我的发布               │
│ ┌─────────────────────┐ │
│ │ iPhone15出售       │ │
│ │ 状态: 上架中        │ │
│ │ 进度: ■■■■□□ 4/10  │ │
│ │ [下架] [重新上架]   │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

### 交互规范
- **按钮尺寸**: 最小点击区域48px × 48px
- **字体大小**: 最小16px，重要信息18px+
- **色彩规范**: 主色调蓝色#007AFF，成功绿色#34C759，警告红色#FF3B30
- **圆角半径**: 卡片12px，按钮8px，输入框6px
- **间距规范**: 12px基础间距，24px区块间距

### 动画效果
- **页面切换**: 300ms淡入淡出
- **按钮点击**: 100ms缩放动画
- **列表加载**: 骨架屏过渡
- **Toast提示**: 从底部滑入，2秒后自动消失

---

## ⚙️ 后台管理系统

### 1. 用户管理

#### 1.1 用户列表
**功能描述**: 查看和管理平台所有用户

**列表字段**:
- 用户ID、手机号、微信号
- 注册时间、最后登录时间
- 积分余额、成交率、发布数
- 用户状态 (正常/禁用)

**操作功能**:
- 搜索用户 (手机号/微信号)
- 禁用/解禁用户
- 手动增减积分
- 查看用户详情

#### 1.2 用户详情
**详情信息**:
- 基本信息 (注册信息、联系方式)
- 行为统计 (发布数、查看数、成交率)
- 积分流水 (收入支出明细)
- 操作日志 (登录、发布、充值记录)

### 2. 信息管理

#### 2.1 信息列表
**列表字段**:
- 信息ID、标题、价格、类型
- 发布者信息、成交率
- 查看次数、成交次数
- 发布时间、状态 (上架/下架)

**操作功能**:
- 搜索筛选 (按标题/类型/状态)
- 删除违规信息
- 一键下架
- 置顶推荐

#### 2.2 内容审核
**审核功能**:
- 敏感词自动检测
- 人工审核界面
- 违规信息处理
- 审核记录统计

### 3. 财务管理

#### 3.1 充值订单管理
**订单列表**:
- 订单号、用户信息
- 充值金额、积分数量
- 支付状态 (待确认/已到账)
- 创建时间、确认时间

**操作功能**:
- 查看订单详情
- 确认到账
- 导出财务报表
- 统计分析图表

**审核流程**:
1. 用户提交充值后自动生成工单，状态=待审核，并附带付款二维码来源及≤2MB截图。
2. 系统调用 Spug SMS（https://push.spug.cc/send/Xyd9M8AlV5rKbDBk）提醒值班管理员处理，短信内容包含用户、金额、截图链接。
3. 管理员核对金额、备注、截图后点击“确认到账”或“驳回”，系统写入审核日志并通知用户积分变更结果。

#### 3.2 积分流水监控
**流水统计**:
- 总积分发行量
- 积分消费统计
- 用户积分分布
- 积分流转趋势

#### 3.3 二维码管理
**作用**: 统一维护微信/支付宝收款码，确保热更新与风控可追溯。

**管理功能**:
- 上传/替换二维码图片（支持 JPG/PNG，最大2MB），自动存入 Supabase Storage bucket `recharge-assets`。
- 记录上传人、备注、指向渠道（微信/支付宝）、图片 URL、MD5 哈希及生效版本号。
- 支持“立即生效/定时生效”，生效后刷新前端 CDN 版本参数，保证5分钟内更新。
- 历史版本留档，可随时回滚并导出审计日志。

### 4. 数据统计

#### 4.1 核心指标
**用户指标**:
- 总用户数、日活跃用户
- 新增用户趋势
- 用户留存率

**业务指标**:
- 日发布量、日成交量
- 平均成交率
- 积分消耗量

#### 4.2 可视化报表
**图表类型**:
- 用户增长趋势图
- 交易量柱状图
- 成交率分布图
- 积分流水饼图

### 5. 运营工具

#### 5.1 关键词监控
**监控功能**:
- 敏感词库配置
- 实时监控报警
- 违规信息统计
- 关键词热度分析

#### 5.2 批量发帖工具
**业务目标**: 面向运营/客服同学，一次性粘贴多条素材，系统借助 AI 拆分并批量投放，减少重复录入。

**操作流程**:
1. 选择交易类型与统一联系方式（支持从常用模板中选取）。
2. 输入原始描述或导入文档 → 点击“AI解析”。
3. 查看模型拆分结果，支持逐条修订标题、价格、备注，或批量调整标签。
4. 选择“立即发布”或“仅保存草稿”，确认弹窗展示条目数与预计积分扣减。

**AI配置**:
- 统一调用前台的 `/api/listings/batch/parse` 能力，底层依旧是 DeepSeek 服务。
- 允许运营指定 Prompt 模板（如“以演唱会票务语气输出”），系统保存为预设，保持与用户端一致的字段结构。
- 每次解析记录模型版本、请求耗时与返回 token 数，便于后续成本核算。

**风控要求**:
- 单批次最多生成20条，超过需拆批；触发阈值时要求人工二次确认。
- 自动检测价格/标题中是否包含黑名单词，违规条目在草稿中直接标记并禁止提交。
- 批量任务全程写入 `listing_batches` 表，字段含批次发起人、解析文本哈希、扣分总额，支持审计。
#### 5.3 系统设置
**配置项**:
- 默认发布积分数量
- 默认查看积分数量
- 邀请奖励数值
- 信息有效期设置
- 热门关键词配置

#### 5.4 公告管理
**公告功能**:
- 创建/编辑/删除公告
- 设置公告优先级
- 公告发布状态控制
- 查看公告阅读数据

---

## 💻 技术需求规范

### 1. 前端技术要求

#### 1.1 响应式设计
- **移动端优先**: 基于iPhone 6/7/8 (375px)设计
- **适配范围**: 320px - 768px宽度覆盖
- **触控优化**: 最小点击区域48px，间距12px

#### 1.2 性能要求
- **加载时间**: 首屏加载时间<2秒
- **交互响应**: 操作反馈时间<200ms
- **动画流畅**: 60fps动画效果
- **离线支持**: 关键数据本地缓存

#### 1.3 兼容性要求
- **iOS**: Safari 12+, 微信浏览器
- **Android**: Chrome 70+, 微信浏览器
- **小程序**: 微信小程序版本 (可选)

### 2. 后端技术要求

#### 2.1 系统架构
- **微服务架构**: 用户服务、交易服务、积分服务分离
- **数据库设计**: 支持高并发读写，数据一致性保障
- **缓存策略**: Redis缓存热点数据
- **消息队列**: 异步处理耗时操作

#### 2.2 安全要求
- **数据加密**: 敏感数据AES加密存储
- **API安全**: JWT认证，接口限流
- **防刷机制**: 短信验证码防刷，积分防作弊
- **SQL注入防护**: 参数化查询，输入验证

#### 2.3 性能指标
- **并发支持**: 1000+ QPS
- **响应时间**: API响应时间<100ms
- **可用性**: 99.9%服务可用性
- **数据备份**: 每日自动备份，异地容灾

### 3. 数据库设计

#### 3.1 核心数据表
```sql
-- 用户表
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    phone VARCHAR(11) UNIQUE NOT NULL,
    wechat_id VARCHAR(50) UNIQUE NOT NULL,
    invite_code VARCHAR(10) UNIQUE,
    points INT DEFAULT 100,
    deal_rate DECIMAL(5,2) DEFAULT 0.00,
    total_posts INT DEFAULT 0,
    total_deals INT DEFAULT 0,
    status TINYINT DEFAULT 1 COMMENT '1:正常 0:禁用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 交易信息表
CREATE TABLE posts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    title VARCHAR(100) NOT NULL,
    keywords VARCHAR(200) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    trade_type TINYINT NOT NULL COMMENT '1:求购 2:出售 3:做多 4:做空',
    delivery_date DATE NULL COMMENT '交割时间',
    extra_info VARCHAR(100) NULL COMMENT '补充信息',
    view_limit INT DEFAULT 10,
    view_count INT DEFAULT 0,
    deal_count INT DEFAULT 0,
    status TINYINT DEFAULT 1 COMMENT '1:上架 0:下架',
    expire_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_trade_type (trade_type),
    INDEX idx_status_created (status, created_at),
    INDEX idx_deal_rate (deal_rate)
);
```

#### 3.2 积分流水表
```sql
CREATE TABLE point_transactions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    change_type TINYINT NOT NULL COMMENT '1:充值 2:发布 3:查看 4:奖励 5:退还',
    change_amount INT NOT NULL,
    balance_after INT NOT NULL,
    related_id BIGINT NULL COMMENT '关联业务ID',
    description VARCHAR(200) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_change_type (change_type),
    INDEX idx_created_at (created_at)
);
```

### 4. API设计规范

#### 4.1 RESTful API设计
```
# 用户相关
POST /api/v1/auth/register          # 用户注册
POST /api/v1/auth/login             # 用户登录
GET  /api/v1/users/profile         # 获取用户信息
PUT  /api/v1/users/profile         # 更新用户信息

# 交易信息相关
POST /api/v1/posts                 # 发布信息
GET  /api/v1/posts                 # 获取信息列表
GET  /api/v1/posts/:id             # 获取信息详情
PUT  /api/v1/posts/:id/status      # 更新信息状态
POST /api/v1/posts/:id/contact     # 查看联系方式

# 积分相关
GET  /api/v1/points/balance        # 获取积分余额
GET  /api/v1/points/transactions   # 获取积分流水
POST /api/v1/points/recharge       # 积分充值
```

#### 4.2 响应格式规范
```json
{
  "code": 200,
  "message": "success",
  "data": {
    // 具体数据内容
  },
  "timestamp": 1643723400000
}
```

---

## 🛡️ 运营与风控

### 1. 内容安全

#### 1.1 敏感词监控
**词库分类**:
- 违法违规类: 涉及政治、暴力、色情等
- 金融诈骗类: 涉及高收益、无风险等承诺
- 虚假信息类: 涉及夸大、不实宣传

**监控机制**:
- 发布时实时检测
- 定期全站扫描
- 用户举报机制
- 人工审核流程

#### 1.2 用户行为监控
**异常行为识别**:
- 短时间内大量发布信息
- 频繁查看不同用户联系方式
- 异常积分充值和消费模式
- 多账号关联操作
- AI批量发布单批次>20条或重复模板

**处理措施**:
- 自动限制异常账号
- 人工复核可疑行为
- 永久封禁严重违规
- 建立黑名单机制

#### 1.3 媒资与AI内容审核
**覆盖范围**:
- 充值付款截图、发布信息中的图片/附件。
- AI批量发布产生的草稿文本。

**策略**:
- 上传端限制 ≤2MB，超限直接拒绝并提示压缩。
- OCR + 敏感词联合检测，识别诈骗、违规票务等关键信息。
- AI拆分结果随机抽检10%，人工确认价格/标题是否失真，必要时回滚整批次。
- 保存原图/原始文本哈希与审核记录，支持风控追溯。

### 2. 积分体系风控

#### 2.1 积分反作弊
**防刷机制**:
- 短信验证码: 5分钟有效期，3次错误锁定1小时
- 发布限制: 同一用户1小时内最多发布5条信息
- 查看限制: 同一用户1小时内最多查看20条联系方式
- 充值监控: 异常大额充值人工审核
- 批量发布扣分校验: 解析条数与扣减积分不匹配时立即阻断

#### 2.2 积分安全
**安全措施**:
- 积分操作日志完整记录
- 关键操作二次验证
- 积分变动实时通知
- 异常积分流动自动冻结
- 退还/扣减事务幂等校验，防止重复退还

### 3. 法律合规

#### 3.1 用户协议
**必含条款**:
- 平台免责声明
- 用户行为规范
- 隐私保护政策
- 知识产权说明

#### 3.2 数据保护
**保护措施**:
- 用户信息加密存储
- 最小化数据收集原则
- 用户数据删除权
- 数据访问权限控制

---

## 📊 数据指标与监控

### 1. 核心业务指标

#### 1.1 用户指标
| 指标名称 | 计算方式 | 目标值 |
|---------|---------|--------|
| 日新增用户数 | 每日新注册用户数 | 100+ |
| 日活跃用户数 | 每日登录用户数 | 500+ |
| 用户留存率 | 次日/7日/30日留存 | 60%/40%/20% |
| 用户邀请率 | 邀请他人注册的用户占比 | 30% |

#### 1.2 交易指标
| 指标名称 | 计算方式 | 目标值 |
|---------|---------|--------|
| 日发布量 | 每日新发布信息数 | 200+ |
| 日成交量 | 每日确认成交数 | 50+ |
| 平均成交率 | 所有用户成交率平均值 | 60%+ |
| 信息匹配效率 | 从发布到首次查看的平均时间 | <2小时 |

#### 1.3 积分指标
| 指标名称 | 计算方式 | 目标值 |
|---------|---------|--------|
| 日积分消耗量 | 每日积分总消耗 | 1000+ |
| 日积分充值量 | 每日积分总充值 | 1200+ |
| 积分流转率 | 积分消耗量/积分总量 | 80%+ |
| ARPU值 | 平均每用户收入 | 10元/月 |

### 2. 技术监控指标

#### 2.1 系统性能
- **API响应时间**: 平均响应时间<100ms
- **数据库性能**: 查询响应时间<50ms
- **缓存命中率**: Redis缓存命中率>90%
- **错误率**: 系统错误率<0.1%

#### 2.2 业务监控
- **注册转化率**: 访问注册页面的用户完成注册的比例
- **发布转化率**: 注册用户24小时内发布信息的比例
- **付费转化率**: 用户查看联系方式并支付积分的比例
- **邀请转化率**: 被邀请用户完成首次发布的比例

### 3. 监控告警

#### 3.1 实时告警
**告警场景**:
- 系统错误率超过1%
- API响应时间超过500ms
- 数据库连接池使用率超过80%
- 积分异常大量消耗

**告警方式**:
- 短信通知技术负责人
- 邮件通知产品运营团队
- 微信群通知开发团队
- 监控大屏显示异常状态

#### 3.2 数据报表
**日报内容**:
- 用户增长和活跃数据
- 交易量和成交率统计
- 积分充值和消耗分析
- 系统运行状态报告

**周报内容**:
- 用户行为分析
- 内容质量评估
- 运营活动效果
- 技术优化建议

---

## 🚀 项目里程碑

### Phase 1: MVP核心功能 (4周)

#### Week 1: 基础架构搭建
- **技术选型**: 确定前后端技术栈
- **数据库设计**: 完成核心表结构设计
- **API设计**: 定义主要接口规范
- **开发环境**: 搭建开发和测试环境

#### Week 2: 用户系统开发
- **注册登录**: 手机号+验证码登录
- **用户中心**: 基础个人信息管理
- **积分系统**: 积分获取和消费逻辑
- **邀请机制**: 邀请码生成和奖励发放

#### Week 3: 交易系统开发
- **信息发布**: 发布表单和校验逻辑
- **信息展示**: 列表和详情页面
- **搜索功能**: 关键词搜索和筛选
- **成交率系统**: 成交确认和率计算

#### Week 4: 移动端优化和测试
- **移动端适配**: 响应式设计实现
- **交互优化**: 触控体验优化
- **功能测试**: 完整功能测试
- **性能优化**: 加载速度和响应优化

**Phase 1交付物**:
- 可用的MVP版本 (Web + 移动端H5)
- 核心功能完整实现
- 基础后台管理系统
- 测试报告和性能数据

### Phase 2: 完整功能开发 (3周)

#### Week 5: 后台管理系统
- **用户管理**: 用户列表和详情管理
- **内容管理**: 信息审核和管理
- **财务管理**: 充值订单和积分流水
- **数据统计**: 基础数据报表

#### Week 6: 高级功能开发
- **自动下架**: 定时任务和积分退还
- **批量操作**: 后台批量发布功能
- **系统公告**: 公告发布和展示
- **关键词监控**: 敏感词检测系统

#### Week 7: AI功能集成
- **AI API集成**: 大模型API对接
- **智能解析**: 文本自动结构化处理
- **批量发帖**: AI辅助批量发布
- **智能推荐**: 基于用户行为推荐

**Phase 2交付物**:
- 功能完整的1.0版本
- 完善的后台管理系统
- AI智能化功能
- 压力测试报告

### Phase 3: 优化和上线 (2周)

#### Week 8: 性能优化和安全加固
- **性能优化**: 数据库查询优化，缓存策略
- **安全加固**: API安全，数据加密
- **用户体验**: 动画效果，交互优化
- **兼容性测试**: 多设备兼容性验证

#### Week 9: 部署上线和运营准备
- **Sealos部署**: 云端环境配置和部署
- **域名配置**: HTTPS证书和域名解析
- **监控配置**: 系统监控和告警设置
- **运营准备**: 内容填充，用户测试

**Phase 3交付物**:
- 生产环境稳定运行的系统
- 完整的部署和运维文档
- 监控和告警系统
- 运营手册和应急预案

### Phase 4: 运营推广 (持续)

#### 推广策略
- **种子用户**: 邀请100名种子用户测试
- **内容冷启动**: AI批量发布优质内容
- **社群运营**: 建立用户交流群
- **数据驱动**: 基于数据持续优化产品

#### 迭代计划
- **用户反馈**: 收集用户反馈和需求
- **功能迭代**: 每两周一次小版本更新
- **性能优化**: 持续优化系统性能
- **新功能**: 基于业务需求开发新功能

---

## 📝 附录

### A. 术语表

| 术语 | 定义 |
|------|------|
| 做多 | 看涨交易，预期价格上涨 |
| 做空 | 看跌交易，预期价格下跌 |
| 积分 | 平台内虚拟货币，用于购买服务 |
| 成交率 | 用户成功交易的比例，信用指标 |
| 撮合 | 买卖双方信息匹配的服务 |

### B. 相关文档
- [技术架构设计文档](link-to-tech-doc)
- [API接口文档](link-to-api-doc)
- [UI设计规范文档](link-to-ui-doc)
- [测试用例文档](link-to-test-doc)
- [运营手册](link-to-operation-doc)

### C. 联系信息
- **产品负责人**: [姓名] [邮箱]
- **技术负责人**: [姓名] [邮箱]
- **UI设计师**: [姓名] [邮箱]
- **运营负责人**: [姓名] [邮箱]

---

**文档状态**: 待评审
**下次更新**: 根据开发进展更新
**版本历史**: V1.0 - 初始版本